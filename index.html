<!DOCTYPE html>
<html lang="mr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Jivandhara Fund Manager</title>
<style>
  body { font-family: Arial, sans-serif; padding: 10px; max-width: 900px; margin: auto; background: #f7f9fc; }
  h2 { margin-top: 30px; }
  input, button, select { font-size: 1rem; padding: 6px 8px; margin: 4px 0; }
  table { border-collapse: collapse; width: 100%; margin-bottom: 15px; background: white; }
  th, td { border: 1px solid #aaa; padding: 6px; text-align: center; }
  th { background-color: #d0f0d0; }
  td[contenteditable] { background-color: #fefefe; cursor: text; }
  button { cursor: pointer; }
  .flex-row { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
  .totals { font-weight: bold; background: #e0ffe0; }
  .small-btn { font-size: 0.8rem; padding: 2px 6px; }
  .section { margin-bottom: 40px; padding: 10px; background: #fff; box-shadow: 0 0 5px #ccc; border-radius: 4px;}
  label { display: block; margin-top: 8px; }
  @media(max-width: 600px) {
    body { padding: 5px; }
    table, .flex-row { font-size: 0.9rem; }
  
  #memberListTable th {
  background: #c2e0ff;
}
#memberListTable td {
  background: #f9f9f9;
}


  }

</style>
</head>
<body>
  
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>


<h1>Jivandhara Fund Manager</h1>
<div style="margin-left:auto;font-weight:700">Application Developed by Vaibhav Enterprises</div>
<section class="section">
  <h2>‡§®‡§µ‡§æ ‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§ú‡•ã‡§°‡§æ</h2>
  <div class="flex-row">
    <input type="text" id="memberName" placeholder="‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§®‡§æ‡§µ" />
    <input type="text" id="memberContact" placeholder="‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï" />
    <button onclick="addMember()">‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§ú‡•ã‡§°‡§æ</button>
    <button onclick="backupAllToCloud()">‚òÅÔ∏è ‡§∏‡§∞‡•ç‡§µ ‡§∏‡§¶‡§∏‡•ç‡§Ø Backup</button>
<button onclick="restoreFromCloud()">üì• Backup ‡§Æ‡§ß‡•Ç‡§® Load</button>


</div>
</section>

<section class="section">
  <h2>‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§®‡§ø‡§µ‡§°‡§æ</h2>
  <select id="memberSelect" onchange="loadMemberData()">
    <option value="">-- ‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§®‡§ø‡§µ‡§°‡§æ --</option>
  </select>
  <button onclick="deleteMember()" style="background:#e66464; color:white;">Delete ‡§∏‡§¶‡§∏‡•ç‡§Ø</button>
</section>

<section class="section">
  <h2>‡§∏‡§¶‡§∏‡•ç‡§Ø‡§æ‡§Ç‡§ö‡•Ä ‡§Ø‡§æ‡§¶‡•Ä</h2>
  <button onclick="showMemberList()">‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§Ø‡§æ‡§¶‡•Ä ‡§¶‡§æ‡§ñ‡§µ‡§æ</button>
  <table id="memberListTable" style="margin-top: 10px; display: none;">
    <thead>
      <tr>
        <th>‡§®‡§æ‡§µ</th>
        <th>Total Share Amount (T.S.A)</th>
        <th>Total Loan Balance Amount (T.L.B.A)</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button onclick="downloadMemberListPDF()">üìÑ Download PDF</button>

</section>


<section class="section" id="memberDataSection" style="display:none;">

  <h2>Share ‡§ú‡§Æ‡§æ (‚Çπ)</h2>
  <table id="shareTable">
    <thead>
      <tr><th>‡§Æ‡§π‡§ø‡§®‡§æ</th><th>‡§ú‡§Æ‡§æ ‡§∞‡§ï‡•ç‡§ï‡§Æ (‚Çπ)</th></tr>
    </thead>
    <tbody></tbody>
    <tfoot>
      <tr class="totals">
        <td>‡§è‡§ï‡•Ç‡§£ ‡§ú‡§Æ‡§æ</td>
        <td id="totalShare">0</td>
      </tr>
    </tfoot>
  </table>
  <button onclick="addShareRow()">+ Add Row</button>
  
<button onclick="removeShareRow()">- Remove Row</button>
<div id="shareRowCount" style="display:inline-block; margin-left:10px; font-weight:bold;">Rows: 0</div>

  <h2>‡§ï‡§∞‡•ç‡§ú (Loan) (‚Çπ)</h2>
  <table id="loanTable">
    <thead>
      <tr><th>‡§Æ‡§π‡§ø‡§®‡§æ</th><th>‡§ï‡§∞‡•ç‡§ú ‡§∞‡§ï‡•ç‡§ï‡§Æ (‚Çπ)</th><th>‡§µ‡•ç‡§Ø‡§æ‡§ú (3%)</th><th>‡§Æ‡•Å‡§¶‡•ç‡§¶‡§≤ ‡§≠‡§∞‡§≤‡•á</th><th>‡§∂‡§ø‡§≤‡•ç‡§≤‡§ï</th></tr>
    </thead>
    <tbody></tbody>
    <tfoot>
      <tr class="totals">
        <td>‡§è‡§ï‡•Ç‡§£</td>
        <td id="totalLoan">0</td>
        <td id="totalInterest">0</td>
        <td id="totalPrincipal">0</td>
        <td id="totalBalance">0</td>
      </tr>
    </tfoot>
  </table>
  <button onclick="addLoanRow()">+ Add Row</button>
 <button onclick="removeLoanRow()">- Remove Row</button>
<div id="loanRowCount" style="display:inline-block; margin-left:10px; font-weight:bold;">Rows: 0</div>

</section>

<section class="section">
  <h2>‡§°‡•á‡§ü‡§æ Export / Import</h2>
  <div class="flex-row">
    <button onclick="exportExcel()">Export Excel</button>
    <input type="file" id="importFile" accept=".xlsx,.xls" />
    <button onclick="importExcel()">Import Excel</button>
  </div>
</section>

<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

<script>
  // Data structure: array of members, each with name, contact, shares[], loans[]
  let members = [];

  // Currently selected member index
  let currentMemberIndex = null;

  // Load members from localStorage
  function loadMembers() {
    const data = localStorage.getItem('jivandharaMembers');
    members = data ? JSON.parse(data) : [];
    populateMemberSelect();
  }

  function saveMembers() {
    localStorage.setItem('jivandharaMembers', JSON.stringify(members));
  }

  function populateMemberSelect() {
    const select = document.getElementById('memberSelect');
    select.innerHTML = '<option value="">-- ‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§®‡§ø‡§µ‡§°‡§æ --</option>';
    members.forEach((m, i) => {
      select.innerHTML += `<option value="${i}">${m.name} (${m.contact})</option>`;
    });
  }

  function addMember() {
    const name = document.getElementById('memberName').value.trim();
    const contact = document.getElementById('memberContact').value.trim();
    if (!name) {
      alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§¶‡§∏‡•ç‡§Ø‡§æ‡§ö‡•á ‡§®‡§æ‡§µ ‡§ü‡§æ‡§ï‡§æ");
      return;
    }
    if(members.some(m => m.name.toLowerCase() === name.toLowerCase())) {
      alert("‡§π‡•á ‡§®‡§æ‡§µ ‡§Ü‡§ß‡•Ä‡§ö ‡§Ü‡§π‡•á.");
      return;
    }
    const newMember = {
      name,
      contact,
      shares: [],
      loans: []
    };
    members.push(newMember);
    saveMembers();
    populateMemberSelect();
    document.getElementById('memberName').value = '';
    document.getElementById('memberContact').value = '';
    alert("‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§Ø‡§∂‡§∏‡•ç‡§µ‡•Ä‡§™‡§£‡•á ‡§ú‡•ã‡§°‡§≤‡•á");
  }

  function loadMemberData() {
    const select = document.getElementById('memberSelect');
    const idx = select.value;
    currentMemberIndex = idx === "" ? null : parseInt(idx);

    if(currentMemberIndex === null){
      document.getElementById('memberDataSection').style.display = 'none';
      return;
    }

    document.getElementById('memberDataSection').style.display = 'block';

    const member = members[currentMemberIndex];

    // Load shares table
    const shareTbody = document.querySelector('#shareTable tbody');
    shareTbody.innerHTML = '';
    member.shares.forEach((row, i) => {
      shareTbody.appendChild(createShareRow(i + 1, row.amount));
    });
    if(member.shares.length === 0) {
      // Minimum 1 row default
      shareTbody.appendChild(createShareRow(1, 0));
    }
    updateShareTotal();

    // Load loans table
    const loanTbody = document.querySelector('#loanTable tbody');
    loanTbody.innerHTML = '';
    member.loans.forEach((row, i) => {
      loanTbody.appendChild(createLoanRow(i + 1, row.loanAmount, row.interest, row.principalPaid));
    });
    if(member.loans.length === 0) {
      loanTbody.appendChild(createLoanRow(1, 0, 0, 0));
    }
    updateLoanTotals();

    // Attach event listeners for contenteditable cells
    addContentEditableListeners();
  }

  function createShareRow(month, amount) {
    const tr = document.createElement('tr');
    const tdMonth = document.createElement('td');
    tdMonth.textContent = month;
    tr.appendChild(tdMonth);

    const tdAmount = document.createElement('td');
    tdAmount.contentEditable = "true";
    tdAmount.textContent = amount || "0";
    tdAmount.addEventListener('input', () => {
      saveShareData();
      updateShareTotal();
    });
    tr.appendChild(tdAmount);

    return tr;
  }

  function createLoanRow(month, loanAmount, interest, principalPaid) {
    const tr = document.createElement('tr');

    // Month cell
    const tdMonth = document.createElement('td');
    tdMonth.textContent = month;
    tr.appendChild(tdMonth);

    // Loan amount cell (editable)
    const tdLoan = document.createElement('td');
    tdLoan.contentEditable = "true";
    tdLoan.textContent = loanAmount || "0";
    tdLoan.addEventListener('input', () => {
      recalcLoanRow(tr);
      saveLoanData();
      updateLoanTotals();
    });
    tr.appendChild(tdLoan);

    // Interest cell (auto-calculated, not editable)
    const tdInterest = document.createElement('td');
    tdInterest.textContent = interest ? interest.toFixed(2) : "0.00";
    tr.appendChild(tdInterest);

    // Principal Paid cell (editable)
    const tdPrincipal = document.createElement('td');
    tdPrincipal.contentEditable = "true";
    tdPrincipal.textContent = principalPaid || "0";
    tdPrincipal.addEventListener('input', () => {
      recalcLoanRow(tr);
      saveLoanData();
      updateLoanTotals();
    });
    tr.appendChild(tdPrincipal);

    // Balance cell (auto-calculated)
    const tdBalance = document.createElement('td');
    tdBalance.textContent = "0.00";
    tr.appendChild(tdBalance);

    // Calculate balance initially
    recalcLoanRow(tr);

    return tr;
  }

  // Add a new share row
  function addShareRow() {
    if(currentMemberIndex === null) return alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§®‡§ø‡§µ‡§°‡§æ");
    const tbody = document.querySelector('#shareTable tbody');
    if(tbody.rows.length >= 36) {
      alert("‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ 36 ‡§Æ‡§π‡§ø‡§®‡•á.");
      return;
    }
    
    const newRow = createShareRow(tbody.rows.length + 1, 0);
    tbody.appendChild(newRow);
    saveShareData();
    updateShareTotal();
  }
  
function removeShareRow() {
  const table = document.getElementById("shareTable").querySelector("tbody");
  if (table.rows.length > 0) {
    table.deleteRow(table.rows.length - 1);
    updateShareRowCount();
    updateShareTotal();
  }
}
  
  // Add a new loan row
  function addLoanRow() {
    if(currentMemberIndex === null) return alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§®‡§ø‡§µ‡§°‡§æ");
    const tbody = document.querySelector('#loanTable tbody');
    if(tbody.rows.length >= 36) {
      alert("‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ 36 ‡§Æ‡§π‡§ø‡§®‡•á.");
      return;
    }
    const newRow = createLoanRow(tbody.rows.length + 1, 0, 0, 0);
    tbody.appendChild(newRow);
    saveLoanData();
    updateLoanTotals();
  }
    
  function removeLoanRow() {
  const table = document.getElementById("loanTable").querySelector("tbody");
  if (table.rows.length > 0) {
    table.deleteRow(table.rows.length - 1);
    updateLoanRowCount();
    updateLoanTotals();
  }
}
  

   function saveShareData() {
    const tbody = document.querySelector('#shareTable tbody');
    const shares = [];
    for(let row of tbody.rows){
      const val = parseFloat(row.cells[1].textContent) || 0;
      shares.push({ amount: val });
    }
    members[currentMemberIndex].shares = shares;
    saveMembers();
  }

  function saveLoanData() {
    const tbody = document.querySelector('#loanTable tbody');
    const loans = [];
    for(let row of tbody.rows){
      const loanAmount = parseFloat(row.cells[1].textContent) || 0;
      const interest = parseFloat(row.cells[2].textContent) || 0;
      const principalPaid = parseFloat(row.cells[3].textContent) || 0;
      // Balance auto-calculated but store if needed
      loans.push({ loanAmount, interest, principalPaid });
    }
    members[currentMemberIndex].loans = loans;
    saveMembers();
  }

  function updateShareTotal() {
    const tbody = document.querySelector('#shareTable tbody');
    let total = 0;
    for(let row of tbody.rows){
      total += parseFloat(row.cells[1].textContent) || 0;
    }
    document.getElementById('totalShare').textContent = total.toFixed(2);
  }

  function recalcLoanRow(tr) {
    // 3% ‡§µ‡•ç‡§Ø‡§æ‡§ú monthly on loan balance (loanAmount - principalPaid)
    const loanAmount = parseFloat(tr.cells[1].textContent) || 0;
    let interest = 0;
    const principalPaid = parseFloat(tr.cells[3].textContent) || 0;

    // ‡§µ‡•ç‡§Ø‡§æ‡§ú = 3% of (loanAmount - principalPaid) if loanAmount > principalPaid
    const balanceBefore = loanAmount - principalPaid;
    if(balanceBefore > 0) {
      interest = balanceBefore * 0.03;
    }

    tr.cells[2].textContent = interest.toFixed(2);

    // Balance = loanAmount + interest - principalPaid
    const balance = loanAmount + interest - principalPaid;
    tr.cells[4].textContent = balance.toFixed(2);
  }

  function updateLoanTotals() {
    const tbody = document.querySelector('#loanTable tbody');
    let totalLoan = 0, totalInterest = 0, totalPrincipal = 0, totalBalance = 0;

    for(let row of tbody.rows){
      totalLoan += parseFloat(row.cells[1].textContent) || 0;
      totalInterest += parseFloat(row.cells[2].textContent) || 0;
      totalPrincipal += parseFloat(row.cells[3].textContent) || 0;
      totalBalance += parseFloat(row.cells[4].textContent) || 0;
    }

    document.getElementById('totalLoan').textContent = totalLoan.toFixed(2);
    document.getElementById('totalInterest').textContent = totalInterest.toFixed(2);
    document.getElementById('totalPrincipal').textContent = totalPrincipal.toFixed(2);
    document.getElementById('totalBalance').textContent = totalBalance.toFixed(2);
  }

  function addContentEditableListeners() {
    // Just to be safe, add input listeners again for dynamic rows
    document.querySelectorAll('#shareTable tbody td[contenteditable]').forEach(td => {
      td.oninput = () => {
        saveShareData();
        updateShareTotal();
      };
    });

    document.querySelectorAll('#loanTable tbody td[contenteditable]').forEach(td => {
      td.oninput = () => {
        const tr = td.parentElement;
        recalcLoanRow(tr);
        saveLoanData();
        updateLoanTotals();
      };
    });
  }

  function deleteMember() {
    if(currentMemberIndex === null) return alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§®‡§ø‡§µ‡§°‡§æ");
    if(confirm(`‡§∏‡§¶‡§∏‡•ç‡§Ø ${members[currentMemberIndex].name} ‡§π‡§ü‡§µ‡§æ‡§Ø‡§ö‡§æ ‡§Ü‡§π‡•á?`)){
      members.splice(currentMemberIndex, 1);
      saveMembers();
      populateMemberSelect();
      currentMemberIndex = null;
      document.getElementById('memberDataSection').style.display = 'none';
    }
  }

  function showMemberList() {
  const table = document.getElementById('memberListTable');
  const tbody = table.querySelector('tbody');
  tbody.innerHTML = ''; // Reset

  members.forEach(member => {
    const totalShare = member.shares.reduce((sum, s) => sum + (parseFloat(s.amount) || 0), 0);
    const totalLoanBalance = member.loans.reduce((sum, l) => {
      const loanAmt = parseFloat(l.loanAmount) || 0;
      const interest = parseFloat(l.interest) || 0;
      const principal = parseFloat(l.principalPaid) || 0;
      const balance = loanAmt + interest - principal;
      return sum + balance;
    }, 0);

    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${member.name}</td>
      <td>‚Çπ ${totalShare.toFixed(2)}</td>
      <td>‚Çπ ${totalLoanBalance.toFixed(2)}</td>
    `;
    tbody.appendChild(tr);
  });

  table.style.display = 'table';
}


function downloadMemberListPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  const headers = [["‡§®‡§æ‡§µ", "Total Share Amount (T.S.A)", "Total Loan Balance (T.L.B.A)"]];
  const data = members.map(member => {
    const totalShare = member.shares.reduce((sum, s) => sum + (parseFloat(s.amount) || 0), 0);
    const totalLoanBalance = member.loans.reduce((sum, l) => {
      const loanAmt = parseFloat(l.loanAmount) || 0;
      const interest = parseFloat(l.interest) || 0;
      const principal = parseFloat(l.principalPaid) || 0;
      const balance = loanAmt + interest - principal;
      return sum + balance;
    }, 0);
    return [member.name, `‚Çπ ${totalShare.toFixed(2)}`, `‚Çπ ${totalLoanBalance.toFixed(2)}`];
  });

  doc.autoTable({
    head: headers,
    body: data,
    styles: { font: "helvetica", fontSize: 10 },
    headStyles: { fillColor: [63, 81, 181], textColor: 255 },
    margin: { top: 20 }
  });

  doc.save("shareholder_list.pdf");
}





  // Excel Export
  function exportExcel() {
    if(currentMemberIndex === null) return alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§®‡§ø‡§µ‡§°‡§æ");
    const member = members[currentMemberIndex];
    const wb = XLSX.utils.book_new();

    // Share sheet
    const shareData = member.shares.map((row, i) => ({
      ‡§Æ‡§π‡§ø‡§®‡§æ: i + 1,
      ‡§ú‡§Æ‡§æ: row.amount
    }));
    const ws1 = XLSX.utils.json_to_sheet(shareData);
    XLSX.utils.book_append_sheet(wb, ws1, "Share ‡§ú‡§Æ‡§æ");

    // Loan sheet
    const loanData = member.loans.map((row, i) => ({
      ‡§Æ‡§π‡§ø‡§®‡§æ: i + 1,
      ‡§ï‡§∞‡•ç‡§ú: row.loanAmount,
      ‡§µ‡•ç‡§Ø‡§æ‡§ú: row.interest,
      ‡§Æ‡•Å‡§¶‡•ç‡§¶‡§≤: row.principalPaid,
      ‡§∂‡§ø‡§≤‡•ç‡§≤‡§ï: row.loanAmount + row.interest - row.principalPaid
    }));
    const ws2 = XLSX.utils.json_to_sheet(loanData);
    XLSX.utils.book_append_sheet(wb, ws2, "Loan");

    XLSX.writeFile(wb, `${member.name}_Jivandhara.xlsx`);
  }

  

function backupAllToCloud() {
  if (!members || members.length === 0) return alert("‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§∏‡§æ‡§™‡§°‡§≤‡•á ‡§®‡§æ‡§π‡•Ä‡§§");

  const allData = members.map(member => {
    const totalShare = member.shares.reduce((sum, s) => sum + parseFloat(s.amount || 0), 0);
    const totalLoan = member.loans.reduce((sum, l) => {
      return sum + (parseFloat(l.loanAmount || 0) + parseFloat(l.interest || 0) - parseFloat(l.principalPaid || 0));
    }, 0);

    return {
      name: member.name || "",
      contact: member.contact || "",
      totalShare: totalShare,
      totalLoan: totalLoan,
      shares: member.shares || [],
      loans: member.loans || []
    };
  });

  fetch("https://script.google.com/macros/s/AKfycbx4QBMq9tcTBc11tlVqYFJfbqQO-4Bung0EKUNBnTdgtVUlZJja5xEJVkl1fRILU7_P/exec", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ members: allData })
  })
    .then(res => res.text())
    .then(msg => alert("‚úÖ Backup OK: " + msg))
    .catch(err => alert("‚ùå Backup Failed: " + err));
}








  // Excel Import
  function importExcel() {
    if(currentMemberIndex === null) return alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§®‡§ø‡§µ‡§°‡§æ");
    const fileInput = document.getElementById('importFile');
    if(fileInput.files.length === 0){
      alert("‡§ï‡•É‡§™‡§Ø‡§æ Excel ‡§´‡§æ‡§à‡§≤ ‡§®‡§ø‡§µ‡§°‡§æ");
      return;
    }
    const file = fileInput.files[0];
    const reader = new FileReader();
    reader.onload = function(e){
      const data = new Uint8Array(e.target.result);
      const wb = XLSX.read(data, {type: 'array'});

      // Read Share ‡§ú‡§Æ‡§æ sheet
      const wsShares = wb.Sheets["Share ‡§ú‡§Æ‡§æ"];
      if(wsShares) {
        const sharesJson = XLSX.utils.sheet_to_json(wsShares);
        members[currentMemberIndex].shares = sharesJson.map(r => ({
          amount: parseFloat(r["‡§ú‡§Æ‡§æ"]) || 0
        }));
      }

      // Read Loan sheet
      const wsLoan = wb.Sheets["Loan"];
      if(wsLoan) {
        const loanJson = XLSX.utils.sheet_to_json(wsLoan);
        members[currentMemberIndex].loans = loanJson.map(r => ({
          loanAmount: parseFloat(r["‡§ï‡§∞‡•ç‡§ú"]) || 0,
          interest: parseFloat(r["‡§µ‡•ç‡§Ø‡§æ‡§ú"]) || 0,
          principalPaid: parseFloat(r["‡§Æ‡•Å‡§¶‡•ç‡§¶‡§≤"]) || 0
        }));
      }
      saveMembers();
      loadMemberData();
      alert("Import ‡§™‡•Ç‡§∞‡•ç‡§£");
    };
    reader.readAsArrayBuffer(file);
  }

  function restoreFromCloud() {
  fetch("https://script.google.com/macros/s/AKfycbx4QBMq9tcTBc11tlVqYFJfbqQO-4Bung0EKUNBnTdgtVUlZJja5xEJVkl1fRILU7_P/exec")
    .then(res => res.json())
    .then(data => {
      members = data.map(d => ({
        name: d["Name"],
        contact: d["Contact"],
        totalShare: parseFloat(d["Total Share"] || 0),
        totalLoan: parseFloat(d["Total Loan"] || 0),
        shares: JSON.parse(d["Shares"] || "[]"),
        loans: JSON.parse(d["Loans"] || "[]")
      }));

      saveToLocal();
      updateMemberDropdown();
      alert("‚úÖ Restore Complete");
    })
    .catch(err => alert("‚ùå Restore Error: " + err));
}


// ‚úÖ ‡§π‡•á ‡§∂‡•á‡§µ‡§ü‡•Ä ‡§ü‡§æ‡§ï‡§æ
window.onload = () => {
  loadFromLocal();
  restoreFromCloud();
};




  // Initialization
  loadMembers();


</script>

</body>
</html>
